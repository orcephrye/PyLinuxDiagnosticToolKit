
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>Sshenvironmentcontrol - PyLinuxDiagnosticToolKit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-sshenvironmentcontrol" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="PyLinuxDiagnosticToolKit" class="md-header__button md-logo" aria-label="PyLinuxDiagnosticToolKit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyLinuxDiagnosticToolKit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sshenvironmentcontrol
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/orcephrye/PyLinuxDiagnosticToolKit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyLinuxDiagnosticToolKit
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PyLinuxDiagnosticToolKit" class="md-nav__button md-logo" aria-label="PyLinuxDiagnosticToolKit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    PyLinuxDiagnosticToolKit
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/orcephrye/PyLinuxDiagnosticToolKit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyLinuxDiagnosticToolKit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Summary
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../TUTORIAL/" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../PyLinuxDiagnosticToolKit/sshConnector/" class="md-nav__link">
        sshConnector
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../PyLinuxDiagnosticToolKit/LinuxModules/" class="md-nav__link">
        CommandContainer
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../CommandContainers/" class="md-nav__link">
        Commandcontainers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../SCPChannel/" class="md-nav__link">
        Scpchannel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../SFTPChannel/" class="md-nav__link">
        Sftpchannel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../genericCmdModule/" class="md-nav__link">
        Genericcmdmodule
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ldtk/" class="md-nav__link">
        Ldtk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sshBufferControl/" class="md-nav__link">
        Sshbuffercontrol
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sshChannelEnvironment/" class="md-nav__link">
        Sshchannelenvironment
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sshConnect/" class="md-nav__link">
        Sshconnect
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Sshenvironmentcontrol
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Sshenvironmentcontrol
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sshenvironmentcontrol" class="md-nav__link">
    sshEnvironmentControl
  </a>
  
    <nav class="md-nav" aria-label="sshEnvironmentControl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processrootlogin" class="md-nav__link">
    processRootLogin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#becomeroot" class="md-nav__link">
    becomeRoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#becomeuser" class="md-nav__link">
    becomeUser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkconnection" class="md-nav__link">
    checkConnection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkwhoami" class="md-nav__link">
    checkWhoAmI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consoleescalation" class="md-nav__link">
    consoleEscalation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createconn" class="md-nav__link">
    createConn
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disconnect" class="md-nav__link">
    disconnect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environmentchange" class="md-nav__link">
    environmentChange
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escalate" class="md-nav__link">
    escalate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executeonenvironment" class="md-nav__link">
    executeOnEnvironment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getprompt" class="md-nav__link">
    getPrompt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logoutconsole" class="md-nav__link">
    logoutConsole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logoutcurrentuser" class="md-nav__link">
    logoutCurrentUser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resetenvironment" class="md-nav__link">
    resetEnvironment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whoami" class="md-nav__link">
    whoami
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sshEnvironmentManager/" class="md-nav__link">
        Sshenvironmentmanager
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../sshThreader/" class="md-nav__link">
        Sshthreader
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#variables" class="md-nav__link">
    Variables
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sshenvironmentcontrol" class="md-nav__link">
    sshEnvironmentControl
  </a>
  
    <nav class="md-nav" aria-label="sshEnvironmentControl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#class-variables" class="md-nav__link">
    Class variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processrootlogin" class="md-nav__link">
    processRootLogin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#becomeroot" class="md-nav__link">
    becomeRoot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#becomeuser" class="md-nav__link">
    becomeUser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkconnection" class="md-nav__link">
    checkConnection
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#checkwhoami" class="md-nav__link">
    checkWhoAmI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consoleescalation" class="md-nav__link">
    consoleEscalation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#createconn" class="md-nav__link">
    createConn
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disconnect" class="md-nav__link">
    disconnect
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environmentchange" class="md-nav__link">
    environmentChange
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#escalate" class="md-nav__link">
    escalate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#executeonenvironment" class="md-nav__link">
    executeOnEnvironment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getprompt" class="md-nav__link">
    getPrompt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logoutconsole" class="md-nav__link">
    logoutConsole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logoutcurrentuser" class="md-nav__link">
    logoutCurrentUser
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resetenvironment" class="md-nav__link">
    resetEnvironment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#whoami" class="md-nav__link">
    whoami
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/orcephrye/PyLinuxDiagnosticToolKit/edit/main/reference/sshEnvironmentControl.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="module-sshenvironmentcontrol">Module sshEnvironmentControl</h1>
<p>None</p>
<p>None</p>
<details class="example"><summary>View Source</summary><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span></pre></div></td><td class="code"><div class="codehilite"><pre><span></span><code><span class="ch">#!/usr/bin/env python</span>

<span class="c1"># -*- coding=utf-8 -*-</span>

<span class="c1">#</span>

<span class="c1"># Author: Timothy Nodine, Ryan Henrichson</span>

<span class="c1"># Version: 0.5.0</span>

<span class="c1"># Date: 10/13/14</span>

<span class="c1"># Description: This is the 4th class in the sshConnector. This is a focus on changing users in a persistent ssh</span>

<span class="c1"># connection. It allows someone to change the user after logging in and keeps track to what user you are and have</span>

<span class="c1"># been.</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">PyLinuxDiagnosticToolKit.libs</span> <span class="kn">import</span> <span class="n">dummy_func</span>

<span class="kn">from</span> <span class="nn">PyLinuxDiagnosticToolKit.libs.LDTKExceptions</span> <span class="kn">import</span> <span class="n">BecomeUserException</span><span class="p">,</span> <span class="n">SSHExceptionChannel</span>

<span class="kn">from</span> <span class="nn">sshConnector.sshBufferControl</span> <span class="kn">import</span> <span class="n">sshBufferControl</span>

<span class="kn">from</span> <span class="nn">sshConnector.sshLibs.sshChannelEnvironment</span> <span class="kn">import</span> <span class="n">sshEnvironment</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;sshEnvironmentControl&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">sshEnvironmentControl</span><span class="p">(</span><span class="n">sshBufferControl</span><span class="p">):</span>

    <span class="c1"># Regex&#39;s used to pull command tags.</span>

    <span class="n">matchRe</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?&lt;=^CMDSTART).+&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="c1"># clean up any errors or other data that may appear before the start tag</span>

    <span class="n">startSubRe</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;.*?(?=^CMDSTART)&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="c1"># clean up all data after the end tag</span>

    <span class="n">endSubRe</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;CMDEND.*&#39;</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; init function for sshEnvironmentControl.</span>

<span class="sd">            This class has methods that control the state of a shell environment that the Paramiko Channel object is</span>

<span class="sd">            connected too. It can do things such as user escalation, change shell type, export variables and so on.</span>

<span class="sd">        - :param arguments: If this is not passed then sshUserControl simply moves along to its super class sshCommand.</span>

<span class="sd">        - :param kwargs: Exists to help safely deal with inheritance.</span>

<span class="sd">        - :return: This is a __init__ class and doesn&#39;t have a return.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">sshEnvironmentControl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">arguments</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">():</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;su -&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">additionalInput</span><span class="o">=</span><span class="n">arguments</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_promptWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">iotime</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">arguments</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">becomeRoot</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">escalate</span><span class="p">(</span><span class="n">escalationCmd</span><span class="o">=</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="n">escalationArgs</span><span class="o">=</span><span class="s1">&#39;-norc&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BASH&#39;</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">escalate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">env</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; The default escalation method. This can handle console or environment changes. It uses the console</span>

<span class="sd">            and env bool parameters to control what type of console change will happen. If both are false the method</span>

<span class="sd">            will call the &#39;becomeUser&#39; method.</span>

<span class="sd">        - :param args: (tuple) - passed on</span>

<span class="sd">        - :param env: (bool) default False - This will be checked first and will call &#39;environmentChange&#39; method.</span>

<span class="sd">        - :param console: (bool) default False - This will be checked second and will call &#39;consoleEscalation&#39; method.</span>

<span class="sd">        - :param kwargs: (dict) - passed on</span>

<span class="sd">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;environment&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">env</span><span class="p">:</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">environmentChange</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">console</span><span class="p">:</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consoleEscalation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">becomeRoot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loginCmd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verifyUser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

                   <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Helpful tool for quickly escalating to the root user. This method can be called without any use of it&#39;s</span>

<span class="sd">            parameters as it can get these from &#39;self&#39;. However, passing a specific environment is necessary to</span>

<span class="sd">            escalate to root on that environment.</span>

<span class="sd">        - :param loginCmd: (str) default None - This is usually &#39;su -&#39; or &#39;sudo&#39;.</span>

<span class="sd">        - :param password: (str) default None - This can be filled by &#39;self.rootpwd&#39; which is itself is populated by the</span>

<span class="sd">            value of the argument &#39;--rootpwd&#39;.</span>

<span class="sd">        - :param verifyUser: (bool) default True - This will run a whoami check after escalation to make sure the</span>

<span class="sd">            environment has been escalated to root. It will return False if the user escalation too root failed.</span>

<span class="sd">        - :param environment: (sshEnvironment) default None - replaced with &#39;self.mainEnvironment&#39; if left empty.</span>

<span class="sd">        - :param kwargs: passed on to the escalate command.</span>

<span class="sd">        - :return: (bool)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span>

        <span class="k">if</span> <span class="n">loginCmd</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">loginCmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootLogin</span>

        <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rootpwd</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Env ID: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2"> - Prompt: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> - Whoami: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="p">,</span> <span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="o">=</span><span class="n">password</span><span class="p">,</span> <span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span>

                        <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Env ID: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2"> - Prompt: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">prompt</span><span class="si">}</span><span class="s2"> - Whoami: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verifyUser</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">whoami</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">becomeUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loginCmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">userName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

                   <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">userEscalation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verifyUser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>

                   <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">unsafe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; This manages the current user and will either escalate or de-escalate to the requested user.</span>

<span class="sd">        - :param loginCmd: (str) - This is typically &#39;su -&#39; or &#39;sudo su -&#39;. Do NOT add the username to this, since it</span>

<span class="sd">                will automatically be appended via the &#39;userName&#39; parameter.</span>

<span class="sd">        - :param userName: (str) - This is appended with a space after the &#39;loginCmd&#39; param.</span>

<span class="sd">        - :param loginPasswd: (str) default None - If not passed the login password will attempt to be populated using</span>

<span class="sd">                existing authentication information.</span>

<span class="sd">        - :param environment: (sshEnvironment) default None - The sshEnvironment that this method will act on.</span>

<span class="sd">        - :param userEscalation: This is a boolean that will change the behavior of becomeUser. If you want to be a user</span>

<span class="sd">                that you already are, the default behavior is to de-escalate to that user. This states that no</span>

<span class="sd">                de-escalation will occur if you want to become a user, rather it will attempt to escalate again.</span>

<span class="sd">                IE: login as default user ie: &#39;server&#39;, then escalate to root, then become &#39;server&#39; again by</span>

<span class="sd">                logging out as root. However, if userEscalation is True it would look like server -&gt; root -&gt; server.</span>

<span class="sd">        - :param verifyUser: (bool) default True - Effects the behavior of becomeUser by deciding whether or not to</span>

<span class="sd">                check and see if the loginCmd was or was not successful when becoming the user in question. It does</span>

<span class="sd">                this by running the &#39;whoami&#39; command and comparing the output to the &#39;userName&#39; variable.</span>

<span class="sd">        - :param reCapturePrompt: (bool) default True - This will re-populate the &#39;prompt&#39; variable in the</span>

<span class="sd">                sshEnvironment class with the new prompt after the escalation is complete.</span>

<span class="sd">        - :param unsafe: (bool) default False - This tells the sshBufferControl to run in &#39;unsafe&#39; mode. This changes</span>

<span class="sd">                how to tell when to stop reading the buffer. It is necessary for most user escalation methods.</span>

<span class="sd">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">strBuffer</span><span class="p">:</span> <span class="n">StringIO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">):</span>

            <span class="c1"># log.debug(&quot;The connection is closed!&quot;)</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Checks to see if you are attempting to become a user you already are.</span>

        <span class="k">if</span> <span class="n">userName</span> <span class="ow">is</span> <span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="p">:</span>

            <span class="c1"># log.debug(&quot;You are attempting to escalate to the user currently logged in as. Skipping&quot;)</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Checks to see if you are attempting to become a user that you have already been and could simple deescalate</span>

        <span class="c1"># too. We will only deescalate if the &#39;userEscalation&#39; flag is False which is default. If true this logic will</span>

        <span class="c1"># not run and the function will simply proceed as normal and attempt to login as the new user.</span>

        <span class="k">if</span> <span class="n">userName</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">userList</span><span class="p">:</span>

            <span class="c1"># log.debug(&quot;You are attempting to escalate to a user you already have logged in as in the past. &quot;</span>

            <span class="c1">#           &quot;This is just a warning&quot;)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">userEscalation</span><span class="p">:</span>

                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_becomePreviousUser</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="n">strBuffer</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span>

        <span class="c1"># We need to us the &#39;-k&#39; flag in order to clear previous uses of sudo from the cache. This fixes issues with</span>

        <span class="c1"># capturing password prompts as it makes sudo ignore previous successful attempts.</span>

        <span class="n">loginCmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processRootLogin</span><span class="p">(</span><span class="n">loginCmd</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">environment</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">environment</span><span class="o">.</span><span class="n">send_ready</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>

                <span class="n">environment</span><span class="o">.</span><span class="n">get_transport</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="k">raise</span> <span class="n">SSHExceptionChannel</span><span class="p">(</span><span class="s1">&#39;Unable to create SSH channel...&#39;</span><span class="p">)</span>

            <span class="n">sleep</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>

        <span class="n">channel</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># We handle logging into root differently then logging in as any other user. We &#39;may&#39; attempt to retry using a</span>

        <span class="c1"># different login command. This retry depends on the &quot;verifyUser&quot; variable.</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">environment</span><span class="o">.</span><span class="n">prompt</span><span class="p">:</span>

                <span class="n">environment</span><span class="o">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escalateUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="o">=</span><span class="n">loginCmd</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span> <span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span>

                                         <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span>

                                         <span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">)</span>

        <span class="k">except</span> <span class="n">BecomeUserException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">rootLoginExplicit</span><span class="p">:</span>

                <span class="k">raise</span> <span class="n">e</span>

            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to become user will try again: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;sudo&#39;</span> <span class="ow">in</span> <span class="n">loginCmd</span><span class="p">:</span>

                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to escalate to user: </span><span class="si">{</span><span class="n">userName</span><span class="si">}</span><span class="s2"> with command: </span><span class="si">{</span><span class="n">loginCmd</span><span class="si">}</span><span class="s2">. Trying command: &#39;su -&#39;&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_clearLoginAttempt</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>

                <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escalateUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="o">=</span><span class="s1">&#39;su -&#39;</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span> <span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span>

                                             <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span>

                                             <span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">prompt</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;su -&#39;</span> <span class="ow">in</span> <span class="n">loginCmd</span><span class="p">:</span>

                <span class="n">newLoginCmd</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/sudo -k; /usr/bin/sudo su -&#39;</span>

                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to escalate to user: </span><span class="si">{</span><span class="n">userName</span><span class="si">}</span><span class="s2"> with command: </span><span class="si">{</span><span class="n">loginCmd</span><span class="si">}</span><span class="s2">. &quot;</span>

                         <span class="sa">f</span><span class="s2">&quot;Trying command: </span><span class="si">{</span><span class="n">newLoginCmd</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_clearLoginAttempt</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>

                <span class="n">channel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_escalateUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="o">=</span><span class="n">newLoginCmd</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span> <span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span>

                                             <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span>

                                             <span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">prompt</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown ERROR while user escalation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DEBUG]: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">environment</span><span class="o">.</span><span class="n">isPromptDefault</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">reCapturePrompt</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">useBashnorc</span><span class="p">:</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">escalate</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">escalationCmd</span><span class="o">=</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="n">escalationArgs</span><span class="o">=</span><span class="s1">&#39;-norc&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BASH&#39;</span><span class="p">,</span>

                                  <span class="n">console</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">reCapturePrompt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># environment.getPrompt(reCapturePrompt=reCapturePrompt)</span>

        <span class="k">return</span> <span class="n">channel</span> <span class="ow">or</span> <span class="n">environment</span>

    <span class="k">def</span> <span class="nf">consoleEscalation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">escalationCmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">escalationArgs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">escalationInput</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

                          <span class="n">escalationType</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;console&quot;</span><span class="p">,</span> <span class="n">escalationHook</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

                          <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; This function differs from &#39;becomeUser&#39; as it designed to change the environment from BASH to for example</span>

<span class="sd">            mysql shell or a sqlpluss shell.</span>

<span class="sd">        :param escalationCmd: (str) - The command such as sqlpluss or zsh</span>

<span class="sd">        :param escalationArgs: (str) default &quot;&quot; - Additional args such as &#39;-h localhost&#39;.</span>

<span class="sd">        :param escalationInput: (str) default None - This is used if the command will require input such as a password.</span>

<span class="sd">        :param escalationType: (str) default &quot;console&quot; - This is used to record the escalation type in sshEnvironment.</span>

<span class="sd">        :param escalationHook: (Callable) default None - a method to call instead of the default escalation method.</span>

<span class="sd">        :param name: (str) defualt None - What to call this console change. This can be useful when searching if a</span>

<span class="sd">                sshEnvironment has already escalated to a specific environment.</span>

<span class="sd">        :param environment: sshEnvironment object</span>

<span class="sd">        :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">reCapturePrompt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">strBuffer</span><span class="p">:</span> <span class="n">StringIO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span>

        <span class="k">while</span> <span class="n">environment</span><span class="o">.</span><span class="n">recv_ready</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">environment</span><span class="o">.</span><span class="n">send_ready</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>

                <span class="n">environment</span><span class="o">.</span><span class="n">get_transport</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="k">raise</span> <span class="n">SSHExceptionChannel</span><span class="p">(</span><span class="s1">&#39;Unable to create SSH channel...&#39;</span><span class="p">)</span>

            <span class="n">sleep</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">escalationCmd</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_performEscalation</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">loginCmd</span><span class="o">=</span><span class="n">escalationCmd</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="o">=</span><span class="n">escalationInput</span><span class="p">,</span>

                                              <span class="n">userName</span><span class="o">=</span><span class="n">escalationArgs</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span> <span class="n">console</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>

                                              <span class="n">escalationHook</span><span class="o">=</span><span class="n">escalationHook</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">escalationCmd</span> <span class="o">+</span> <span class="n">escalationArgs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">additionalInput</span><span class="o">=</span><span class="n">escalationInput</span><span class="p">,</span>

                         <span class="n">escalationType</span><span class="o">=</span><span class="n">escalationType</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">environment</span>

    <span class="k">def</span> <span class="nf">environmentChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; Changes the state of the environment in some way other then user or console escalation. This method</span>

<span class="sd">            depends on &#39;consoleEscalation&#39;. It simply adjusted the &#39;escalationType&#39; and &#39;reCapturePrompt&#39; parameters</span>

<span class="sd">            to work for changing the environment. This method is helpful if you want to record the fact that this</span>

<span class="sd">            sshEnvironment has special variables/settings set. Such as editing its PATH or the use of export. That way</span>

<span class="sd">            it is easy to run future commands on that particular environment.</span>

<span class="sd">        - :param: args - Passed to &#39;consoleEscalation&#39;</span>

<span class="sd">        - :param: kwargs - Passed to &#39;consoleEscalation&#39;</span>

<span class="sd">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;escalationType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;env&#39;</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consoleEscalation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resetEnvironment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; As noted by the name this resets the values for the sshEnvironment class. *BE CAREFUL* this doesn&#39;t run</span>

<span class="sd">            commands on the ssh channel environment meaning the actual environment on the target machine hasn&#39;t</span>

<span class="sd">            changed. This only clears the values recorded on the sshEnvironment class.</span>

<span class="sd">        :param environment: (sshEnvironment) default None - the sshEnvironment to run &#39;resetEnvironment&#39; against.</span>

<span class="sd">        :return: None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">getattr</span><span class="p">(</span><span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span><span class="p">,</span> <span class="s1">&#39;resetEnvironment&#39;</span><span class="p">,</span> <span class="n">dummy_func</span><span class="p">)()</span>

    <span class="k">def</span> <span class="nf">logoutCurrentUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">junkOut</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StringIO</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>

                          <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; Runs the command &#39;exit&#39; once on a specified environment. Effectively logging out of a user or other</span>

<span class="sd">            escalation.</span>

<span class="sd">        - :param environment: (sshEnvironment) default None -</span>

<span class="sd">        - :param junkOut: (StringIO) default None -</span>

<span class="sd">        - :param reCapturePrompt: (bool) default True -</span>

<span class="sd">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">):</span>

            <span class="k">return</span> <span class="n">environment</span>

        <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">consoleStack</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">consoleStack</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">environment</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">junkOut</span><span class="p">:</span>

            <span class="n">junkOut</span><span class="p">:</span> <span class="n">StringIO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="n">junkOut</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">pull</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">):</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection still valid on: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2"> - Num Escalations: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">numEscalations</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span> <span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Connection closed on: </span><span class="si">{</span><span class="n">environment</span><span class="o">.</span><span class="n">_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">environment</span>

    <span class="k">def</span> <span class="nf">logoutConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logoutCmd</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; This reverses through past environment changes until it undoes the previous console escalation.</span>

<span class="sd">        :param logoutCmd: (str) (default None) This is a custom command to leave the console. For example &#39;exit&#39; or</span>

<span class="sd">            &#39;quit&#39;.</span>

<span class="sd">        :param environment: (sshEnvironment/Paramiko Channel)</span>

<span class="sd">        :return:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">logoutCmd</span><span class="p">:</span>

            <span class="n">logoutCmd</span> <span class="o">=</span> <span class="s2">&quot;exit&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">(),</span> <span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">pull</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">environment</span><span class="o">.</span><span class="n">__CONSOLE_ESCALATION__</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logoutConsole</span><span class="p">(</span><span class="n">logoutCmd</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">environment</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; This attempts to graceful log out by exiting/de-escalating through all previous console escalations on a</span>

<span class="sd">            given sshEnvironment.</span>

<span class="sd">        - :param environment: (sshEnvironment) default None -</span>

<span class="sd">        - :return: None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span>

        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">numEscalations</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logoutCurrentUser</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">reCapturePrompt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">isMain</span><span class="p">:</span>

            <span class="nb">super</span><span class="p">(</span><span class="n">sshEnvironmentControl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">whoami</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; This returns the &#39;whoami&#39; of the provided sshEnvironment. If an environment is not provided it pulls this</span>

<span class="sd">            from the main Environment. Sense this is looking at a variable this is not always reliable because the</span>

<span class="sd">            variable may become de-synced with its actual environment. Also calling this from a thread may also result</span>

<span class="sd">            in the wrong information if the environment is also being acted upon. For accurate information use the</span>

<span class="sd">            &#39;checkWhoAmI&#39; method as this runs the &#39;whoami&#39; command on sshEnvironment.</span>

<span class="sd">        - :param environment: (sshEnvironment) default None -</span>

<span class="sd">        - :return (str)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span><span class="p">,</span> <span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">checkWhoAmI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; This is the slow but sure fire way to find out what the current user is. This function can be called with a</span>

<span class="sd">            custom channel to determine the user of that channel. If calling from a thread it is required that you pass</span>

<span class="sd">            the channel or else you will get the whoami information for the master channel.</span>

<span class="sd">            Note: When called from a thread this function runs the command directly on the sshCommand buffer. This means</span>

<span class="sd">            that the calling thread has to wait until this is complete. Keep that in mind when using this function.</span>

<span class="sd">        - :param environment: (sshEnvironment) default None -</span>

<span class="sd">        - :return: (str)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">_checkWhoAmIHelper</span><span class="p">(</span><span class="n">cmdResults</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>

                <span class="n">cmdOutputRe</span> <span class="o">=</span> <span class="n">sshEnvironmentControl</span><span class="o">.</span><span class="n">matchRe</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>

                    <span class="n">sshEnvironmentControl</span><span class="o">.</span><span class="n">startSubRe</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cmdResults</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">cmdOutputRe</span><span class="p">:</span>

                    <span class="k">return</span> <span class="n">sshEnvironmentControl</span><span class="o">.</span><span class="n">endSubRe</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">cmdOutputRe</span><span class="o">.</span><span class="n">group</span><span class="p">(),</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error in _checkWhoAmIHelper: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[DEBUG] for _checkWhoAmIHelper: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="n">_checkWhoAmIHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">executeOnEnvironment</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainEnvironment</span><span class="p">,</span>

                                                            <span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;echo CMDSTART; whoami; echo CMDEND&#39;</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getPrompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; This captures the current prompt which is used to improve the performance of the buffer.</span>

<span class="sd">        - :param environment: sshEnvironment object</span>

<span class="sd">        - :return: str or None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># log.debug(f&quot;ID: {environment._id} - Cached Prompt: {environment.prompt} - reCapturePrompt: {reCapturePrompt}&quot;)</span>

        <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">prompt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">reCapturePrompt</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>

            <span class="k">return</span> <span class="n">environment</span><span class="o">.</span><span class="n">prompt</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capturePrompt</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">())</span> <span class="ow">or</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">environment</span><span class="o">.</span><span class="n">prompt</span>

    <span class="k">def</span> <span class="nf">_escalateUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loginCmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">userName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">,</span>

                      <span class="n">verifyUser</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">unsafe</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sshEnvironment</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Used as a helper function for becomeUser</span>

<span class="sd">        - :param loginCmd: (str)</span>

<span class="sd">        - :param userName: (str)</span>

<span class="sd">        - :param loginPasswd: (str)</span>

<span class="sd">        - :param environment: (sshEnvironment)</span>

<span class="sd">        - :param verifyUser: (bool)</span>

<span class="sd">        - :param buffer: (StringIO)</span>

<span class="sd">        - :param unsafe: (bool)</span>

<span class="sd">        - :param kwargs: gets passed along</span>

<span class="sd">        - :return: sshEnvironment</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;noUserPrompt&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_noUserPromptParser</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)})</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_performEscalation</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">loginCmd</span><span class="o">=</span><span class="n">loginCmd</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span>

                                              <span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="n">buffer</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verifyUser</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifyLogin</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">buffer</span><span class="p">):</span>

                <span class="k">raise</span> <span class="n">BecomeUserException</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Unable to become user </span><span class="si">{</span><span class="n">userName</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">environment</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">loginCmd</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span> <span class="n">additionalInput</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span> <span class="n">escalationType</span><span class="o">=</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">environment</span>

    <span class="k">def</span> <span class="nf">_becomePreviousUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">buffer</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sshEnvironment</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Used as a helper function for becomeUser</span>

<span class="sd">        - :param userName: (str)</span>

<span class="sd">        - :param buffer: (StringIO)</span>

<span class="sd">        - :param environment: (sshEnvironment)</span>

<span class="sd">        - :return: (sshEnvironment)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">environment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logoutCurrentUser</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">junkOut</span><span class="o">=</span><span class="n">buffer</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">userName</span> <span class="o">==</span> <span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_verifyLogin</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">buffer</span><span class="p">):</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Failed to de-escalate to the correct user&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">userName</span> <span class="o">!=</span> <span class="n">environment</span><span class="o">.</span><span class="n">whoami</span> <span class="ow">and</span> <span class="n">userName</span> <span class="ow">in</span> <span class="n">environment</span><span class="o">.</span><span class="n">userList</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_becomePreviousUser</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">environment</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">environment</span>

    <span class="k">def</span> <span class="nf">_performEscalation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">loginCmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">userName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>

                           <span class="n">buffer</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">sshEnvironment</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Used as a helper function for multiple methods within sshEnvironmentControl</span>

<span class="sd">        - :param environment: (sshEnvironment)</span>

<span class="sd">        - :param loginCmd: (str)</span>

<span class="sd">        - :param loginPasswd: (str)</span>

<span class="sd">        - :param userName: (str)</span>

<span class="sd">        - :param buffer: (StringIO)</span>

<span class="sd">        - :param kwargs: gets passed along</span>

<span class="sd">        - :return: (sshEnvironment)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">console</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">escalationHook</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;escalationHook&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="n">loginCmd</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">userName</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">escalationHook</span><span class="p">,</span> <span class="n">Callable</span><span class="p">):</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unsafe&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>

                                <span class="n">prompt</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prompt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

            <span class="n">escalationHook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">userName</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">console</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">console</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unsafe&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>

                                <span class="n">prompt</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;prompt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">loginPasswd</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">loginPasswd</span> <span class="ow">or</span> <span class="s1">&#39;sudo&#39;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unsafe&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_insertPassword</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">,</span> <span class="n">environment</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;noUserPrompt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;unsafe&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">environment</span>

    <span class="k">def</span> <span class="nf">_insertPassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">,</span>

                        <span class="n">out</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Used as a helper function for multiple methods within sshEnvironmentControl</span>

<span class="sd">        - :param cmd: (str)</span>

<span class="sd">        - :param loginPasswd: (str)</span>

<span class="sd">        - :param environment: (sshEnvironment)</span>

<span class="sd">        - :param out: (StringIO)</span>

<span class="sd">        - :param prompt: (str)</span>

<span class="sd">        - :return: None</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">environment</span><span class="o">.</span><span class="n">whoami</span> <span class="o">!=</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span>

            <span class="n">wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_passwdWait</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span>

            <span class="n">lastline</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

            <span class="k">if</span> <span class="s1">&#39;assword&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lastline</span> <span class="ow">and</span> <span class="n">lastline</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">promptTextTuple</span><span class="p">):</span>

                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Found a prompt skipping inserting password&quot;</span><span class="p">)</span>

                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="s2">&quot;sudo&quot;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">:</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>

                    <span class="n">loginPasswd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">password</span>

                <span class="k">if</span> <span class="s1">&#39;assword for root&#39;</span> <span class="ow">in</span> <span class="n">lastline</span><span class="p">:</span>

                    <span class="n">loginPasswd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arguments</span><span class="o">.</span><span class="n">rootpwd</span>

                <span class="k">elif</span> <span class="s1">&#39;assword for&#39;</span> <span class="ow">in</span> <span class="n">lastline</span><span class="p">:</span>

                    <span class="n">requestedName</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;assword for(.*):&#39;</span><span class="p">,</span> <span class="n">lastline</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">requestedName</span><span class="p">:</span>

                        <span class="n">requestedName</span> <span class="o">=</span> <span class="n">requestedName</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                        <span class="n">loginPasswd</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">getPasswordFor</span><span class="p">(</span><span class="n">requestedName</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">lastline</span> <span class="ow">or</span> <span class="n">lastline</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">promptTextTuple</span><span class="p">):</span>

                    <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">wait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">loginPasswd</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">unsafe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_promptWait</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">insertNewLine</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_verifyLogin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">userName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="n">StringIO</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Used as a helper function for multiple methods within sshEnvironmentControl</span>

<span class="sd">        - :param environment: (sshEnvironment)</span>

<span class="sd">        - :param userName: (str)</span>

<span class="sd">        - :param out: (StringIO)</span>

<span class="sd">        - :return: bool</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;assword&#39;</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_promptWait</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">insertNewLine</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkWhoAmI</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">userName</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_clearLoginAttempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>

        <span class="sd">&quot;&quot;&quot; Used by becomeUser method</span>

<span class="sd">        - :param environment:</span>

<span class="sd">        - :return: (bool)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>

            <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_noUserPromptParser</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">prompt</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span> <span class="n">currentUser</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="p">)</span>

            <span class="n">lastline</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>

                <span class="n">lastline</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_noUserPromptParser</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span>

                                                    <span class="n">prompt</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_capturePrompt</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">StringIO</span><span class="p">())),</span>

                                                    <span class="n">currentUser</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lastline</span> <span class="ow">and</span> <span class="n">prompt</span> <span class="ow">in</span> <span class="n">lastline</span><span class="p">:</span>

                    <span class="k">return</span> <span class="kc">True</span>

                <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lastline</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">promptTextTuple</span><span class="p">):</span>

                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error in _clearLoginAttempt: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[DEBUG] for _clearLoginAttempt: </span><span class="si">{</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_noUserPromptParser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environment</span><span class="p">:</span> <span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>

        <span class="sd">&quot;&quot;&quot; Used by multiple different private helper methods.</span>

<span class="sd">        - :param environment: (sshEnvironmnet)</span>

<span class="sd">        - :param prompt: (str) default None</span>

<span class="sd">        - :param kwargs: possibly contains &#39;currentUser&#39;</span>

<span class="sd">        - :return: (str/None)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>

            <span class="n">prompt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">reCapturePrompt</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">prompt</span><span class="p">:</span>

            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">currentUser</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;currentUser&#39;</span><span class="p">,</span> <span class="n">environment</span><span class="o">.</span><span class="n">whoami</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span>

        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">currentUser</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>
</details>
<h2 id="variables">Variables</h2>
<div class="codehilite"><pre><span></span><code><span class="n">log</span>
</code></pre></div>

<h2 id="classes">Classes</h2>
<h3 id="sshenvironmentcontrol">sshEnvironmentControl</h3>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">sshEnvironmentControl</span><span class="p">(</span>
    <span class="n">arguments</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>

<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>sshConnector.sshBufferControl.sshBufferControl</li>
<li>sshConnector.sshConnect.sshConnect</li>
</ul>
<h4 id="class-variables">Class variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">arguments</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">endSubRe</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">escapeChars</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">matchRe</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">promptTextTuple</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">ssh</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="n">startSubRe</span>
</code></pre></div>

<h4 id="static-methods">Static methods</h4>
<h4 id="processrootlogin">processRootLogin</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">processRootLogin</span><span class="p">(</span>
    <span class="n">loginMethod</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="nv">@staticmethod</span><span class="w"></span>

<span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">processRootLogin</span><span class="p">(</span><span class="nl">loginMethod</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">str</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;sudo&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">loginMethod</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;/usr/bin/sudo -k; /usr/bin/sudo su -&#39;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;su -&#39;</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="instance-variables">Instance variables</h4>
<div class="codehilite"><pre><span></span><code><span class="n">mainEnvironment</span>
</code></pre></div>

<h4 id="methods">Methods</h4>
<h4 id="becomeroot">becomeRoot</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">becomeRoot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">loginCmd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verifyUser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

<p>Helpful tool for quickly escalating to the root user. This method can be called without any use of it's</p>
<p>parameters as it can get these from 'self'. However, passing a specific environment is necessary to
    escalate to root on that environment.</p>
<ul>
<li>:param loginCmd: (str) default None - This is usually 'su -' or 'sudo'.</li>
<li>:param password: (str) default None - This can be filled by 'self.rootpwd' which is itself is populated by the
    value of the argument '--rootpwd'.</li>
<li>:param verifyUser: (bool) default True - This will run a whoami check after escalation to make sure the
    environment has been escalated to root. It will return False if the user escalation too root failed.</li>
<li>:param environment: (sshEnvironment) default None - replaced with 'self.mainEnvironment' if left empty.</li>
<li>:param kwargs: passed on to the escalate command.</li>
<li>:return: (bool)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">becomeRoot</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">loginCmd</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">password</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">verifyUser</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"></span>

<span class="w">                   </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">sshEnvironment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bool</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Helpful tool for quickly escalating to the root user. This method can be called without any use of it&#39;s</span>

<span class="ss">            parameters as it can get these from &#39;self&#39;. However, passing a specific environment is necessary to</span>

<span class="ss">            escalate to root on that environment.</span>

<span class="ss">        - :param loginCmd: (str) default None - This is usually &#39;su -&#39; or &#39;sudo&#39;.</span>

<span class="ss">        - :param password: (str) default None - This can be filled by &#39;self.rootpwd&#39; which is itself is populated by the</span>

<span class="ss">            value of the argument &#39;--rootpwd&#39;.</span>

<span class="ss">        - :param verifyUser: (bool) default True - This will run a whoami check after escalation to make sure the</span>

<span class="ss">            environment has been escalated to root. It will return False if the user escalation too root failed.</span>

<span class="ss">        - :param environment: (sshEnvironment) default None - replaced with &#39;self.mainEnvironment&#39; if left empty.</span>

<span class="ss">        - :param kwargs: passed on to the escalate command.</span>

<span class="ss">        - :return: (bool)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">loginCmd</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">loginCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">rootLogin</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">rootpwd</span><span class="w"></span>

<span class="w">        </span><span class="n">kwargs</span><span class="o">[</span><span class="n">&#39;reCapturePrompt&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Env ID: {environment._id} - Prompt: {environment.prompt} - Whoami: {environment.whoami}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">loginPasswd</span><span class="o">=</span><span class="n">password</span><span class="p">,</span><span class="w"> </span><span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span><span class="w"></span>

<span class="w">                        </span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Env ID: {environment._id} - Prompt: {environment.prompt} - Whoami: {environment.whoami}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nl">verifyUser</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">True</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">whoami</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">True</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">False</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="becomeuser">becomeUser</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">becomeUser</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">loginCmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">userName</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">loginPasswd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">userEscalation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verifyUser</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">unsafe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

<p>This manages the current user and will either escalate or de-escalate to the requested user.</p>
<ul>
<li>:param loginCmd: (str) - This is typically 'su -' or 'sudo su -'. Do NOT add the username to this, since it
        will automatically be appended via the 'userName' parameter.</li>
<li>:param userName: (str) - This is appended with a space after the 'loginCmd' param.</li>
<li>:param loginPasswd: (str) default None - If not passed the login password will attempt to be populated using
        existing authentication information.</li>
<li>:param environment: (sshEnvironment) default None - The sshEnvironment that this method will act on.</li>
<li>:param userEscalation: This is a boolean that will change the behavior of becomeUser. If you want to be a user
        that you already are, the default behavior is to de-escalate to that user. This states that no
        de-escalation will occur if you want to become a user, rather it will attempt to escalate again.
        IE: login as default user ie: 'server', then escalate to root, then become 'server' again by
        logging out as root. However, if userEscalation is True it would look like server -&gt; root -&gt; server.</li>
<li>:param verifyUser: (bool) default True - Effects the behavior of becomeUser by deciding whether or not to
        check and see if the loginCmd was or was not successful when becoming the user in question. It does
        this by running the 'whoami' command and comparing the output to the 'userName' variable.</li>
<li>:param reCapturePrompt: (bool) default True - This will re-populate the 'prompt' variable in the
        sshEnvironment class with the new prompt after the escalation is complete.</li>
<li>
<p>:param unsafe: (bool) default False - This tells the sshBufferControl to run in 'unsafe' mode. This changes
        how to tell when to stop reading the buffer. It is necessary for most user escalation methods.</p>
</li>
<li>
<p>:return: Either 'sshEnvironment' (success) or False (Failure)</p>
</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">becomeUser</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">loginCmd</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">userName</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">loginPasswd</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                   </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">userEscalation</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"> </span><span class="nl">verifyUser</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"></span>

<span class="w">                   </span><span class="nl">reCapturePrompt</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="nl">unsafe</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">sshEnvironment, bool</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This manages the current user and will either escalate or de-escalate to the requested user.</span>

<span class="ss">        - :param loginCmd: (str) - This is typically &#39;su -&#39; or &#39;sudo su -&#39;. Do NOT add the username to this, since it</span>

<span class="ss">                will automatically be appended via the &#39;userName&#39; parameter.</span>

<span class="ss">        - :param userName: (str) - This is appended with a space after the &#39;loginCmd&#39; param.</span>

<span class="ss">        - :param loginPasswd: (str) default None - If not passed the login password will attempt to be populated using</span>

<span class="ss">                existing authentication information.</span>

<span class="ss">        - :param environment: (sshEnvironment) default None - The sshEnvironment that this method will act on.</span>

<span class="ss">        - :param userEscalation: This is a boolean that will change the behavior of becomeUser. If you want to be a user</span>

<span class="ss">                that you already are, the default behavior is to de-escalate to that user. This states that no</span>

<span class="ss">                de-escalation will occur if you want to become a user, rather it will attempt to escalate again.</span>

<span class="ss">                IE: login as default user ie: &#39;server&#39;, then escalate to root, then become &#39;server&#39; again by</span>

<span class="ss">                logging out as root. However, if userEscalation is True it would look like server -&gt; root -&gt; server.</span>

<span class="ss">        - :param verifyUser: (bool) default True - Effects the behavior of becomeUser by deciding whether or not to</span>

<span class="ss">                check and see if the loginCmd was or was not successful when becoming the user in question. It does</span>

<span class="ss">                this by running the &#39;whoami&#39; command and comparing the output to the &#39;userName&#39; variable.</span>

<span class="ss">        - :param reCapturePrompt: (bool) default True - This will re-populate the &#39;prompt&#39; variable in the</span>

<span class="ss">                sshEnvironment class with the new prompt after the escalation is complete.</span>

<span class="ss">        - :param unsafe: (bool) default False - This tells the sshBufferControl to run in &#39;unsafe&#39; mode. This changes</span>

<span class="ss">                how to tell when to stop reading the buffer. It is necessary for most user escalation methods.</span>

<span class="ss">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="nl">strBuffer</span><span class="p">:</span><span class="w"> </span><span class="n">StringIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;The connection is closed!&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Checks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">attempting</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">become</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="k">are</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">whoami</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;You are attempting to escalate to the user currently logged in as. Skipping&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">Checks</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">see</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="k">are</span><span class="w"> </span><span class="n">attempting</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">become</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">user</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">already</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">deescalate</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">too</span><span class="p">.</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="n">deescalate</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s1">&#39;userEscalation&#39;</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">False</span><span class="w"> </span><span class="n">which</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">default</span><span class="p">.</span><span class="w"> </span><span class="k">If</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">logic</span><span class="w"> </span><span class="n">will</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">will</span><span class="w"> </span><span class="n">simply</span><span class="w"> </span><span class="n">proceed</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="k">user</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">userName</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">userList</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="ss">&quot;You are attempting to escalate to a user you already have logged in as in the past. &quot;</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w">           </span><span class="ss">&quot;This is just a warning&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">userEscalation</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_becomePreviousUser</span><span class="p">(</span><span class="n">userName</span><span class="p">,</span><span class="w"> </span><span class="n">strBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">us</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="s1">&#39;-k&#39;</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">clear</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">fixes</span><span class="w"> </span><span class="n">issues</span><span class="w"> </span><span class="k">with</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">capturing</span><span class="w"> </span><span class="n">password</span><span class="w"> </span><span class="n">prompts</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">makes</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="k">ignore</span><span class="w"> </span><span class="n">previous</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">attempts</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="n">loginCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">processRootLogin</span><span class="p">(</span><span class="n">loginCmd</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">recv_ready</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">True</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">send_ready</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">True</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">closed</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">environment</span><span class="p">.</span><span class="n">get_transport</span><span class="p">().</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">SSHExceptionChannel</span><span class="p">(</span><span class="s1">&#39;Unable to create SSH channel...&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">sleep</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="n">handle</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="k">into</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">differently</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="n">logging</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="ow">any</span><span class="w"> </span><span class="n">other</span><span class="w"> </span><span class="k">user</span><span class="p">.</span><span class="w"> </span><span class="n">We</span><span class="w"> </span><span class="s1">&#39;may&#39;</span><span class="w"> </span><span class="n">attempt</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">retry</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">a</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="n">command</span><span class="p">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">retry</span><span class="w"> </span><span class="n">depends</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="ss">&quot;verifyUser&quot;</span><span class="w"> </span><span class="k">variable</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">prompt</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">environment</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_escalateUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="o">=</span><span class="n">loginCmd</span><span class="p">,</span><span class="w"> </span><span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span><span class="w"></span>

<span class="w">                                         </span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span><span class="w"></span>

<span class="w">                                         </span><span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">BecomeUserException</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">arguments</span><span class="p">.</span><span class="nl">rootLoginExplicit</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">e</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">warning</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Unable to become user will try again: {e}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="s1">&#39;sudo&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">loginCmd</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="nf">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Failed to escalate to user: {userName} with command: {loginCmd}. Trying command: &#39;su -&#39;&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">_clearLoginAttempt</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_escalateUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="o">=</span><span class="s1">&#39;su -&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span><span class="w"></span>

<span class="w">                                             </span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span><span class="w"></span>

<span class="w">                                             </span><span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">,</span><span class="w"> </span><span class="n">prompt</span><span class="o">=</span><span class="n">environment</span><span class="p">.</span><span class="n">prompt</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="s1">&#39;su -&#39;</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nl">loginCmd</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">newLoginCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/usr/bin/sudo -k; /usr/bin/sudo su -&#39;</span><span class="w"></span>

<span class="w">                </span><span class="nf">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Failed to escalate to user: {userName} with command: {loginCmd}. &quot;</span><span class="w"></span>

<span class="w">                         </span><span class="n">f</span><span class="ss">&quot;Trying command: {newLoginCmd}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">_clearLoginAttempt</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="n">channel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_escalateUser</span><span class="p">(</span><span class="n">loginCmd</span><span class="o">=</span><span class="n">newLoginCmd</span><span class="p">,</span><span class="w"> </span><span class="n">loginPasswd</span><span class="o">=</span><span class="n">loginPasswd</span><span class="p">,</span><span class="w"> </span><span class="n">userName</span><span class="o">=</span><span class="n">userName</span><span class="p">,</span><span class="w"></span>

<span class="w">                                             </span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">verifyUser</span><span class="o">=</span><span class="n">verifyUser</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span><span class="w"></span>

<span class="w">                                             </span><span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">,</span><span class="w"> </span><span class="n">prompt</span><span class="o">=</span><span class="n">environment</span><span class="p">.</span><span class="n">prompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="k">Exception</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Unknown ERROR while user escalation: {e}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;[DEBUG]: {traceback.format_exc()}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="nl">finally</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">isPromptDefault</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">reCapturePrompt</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">arguments</span><span class="p">.</span><span class="nl">useBashnorc</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="n">self</span><span class="p">.</span><span class="n">escalate</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">escalationCmd</span><span class="o">=</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">escalationArgs</span><span class="o">=</span><span class="s1">&#39;-norc&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;BASH&#39;</span><span class="p">,</span><span class="w"></span>

<span class="w">                                  </span><span class="n">console</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">unsafe</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"> </span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">channel</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="checkconnection">checkConnection</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">checkConnection</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sshChannel</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">paramiko</span><span class="o">.</span><span class="n">channel</span><span class="o">.</span><span class="n">Channel</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

<p>Creates ssh key object or returns None.</p>
<ul>
<li>:param: (Channel): None or Paramiko channel</li>
<li>:return: (bool)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">checkConnection</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">sshChannel</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Channel</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bool</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Creates ssh key object or returns None.</span>

<span class="ss">        - :param: (Channel): None or Paramiko channel</span>

<span class="ss">        - :return: (bool)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">sshChannel</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">sshChannel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">ssh</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">sshChannel</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">False</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">sshChannel</span><span class="p">.</span><span class="n">get_transport</span><span class="p">().</span><span class="n">is_active</span><span class="p">()</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">sshChannel</span><span class="p">.</span><span class="n">closed</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="checkwhoami">checkWhoAmI</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">checkWhoAmI</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

<p>This is the slow but sure fire way to find out what the current user is. This function can be called with a</p>
<p>custom channel to determine the user of that channel. If calling from a thread it is required that you pass
    the channel or else you will get the whoami information for the master channel.
    Note: When called from a thread this function runs the command directly on the sshCommand buffer. This means
    that the calling thread has to wait until this is complete. Keep that in mind when using this function.</p>
<ul>
<li>:param environment: (sshEnvironment) default None -</li>
<li>:return: (str)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">checkWhoAmI</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">str</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This is the slow but sure fire way to find out what the current user is. This function can be called with a</span>

<span class="ss">            custom channel to determine the user of that channel. If calling from a thread it is required that you pass</span>

<span class="ss">            the channel or else you will get the whoami information for the master channel.</span>

<span class="ss">            Note: When called from a thread this function runs the command directly on the sshCommand buffer. This means</span>

<span class="ss">            that the calling thread has to wait until this is complete. Keep that in mind when using this function.</span>

<span class="ss">        - :param environment: (sshEnvironment) default None -</span>

<span class="ss">        - :return: (str)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">_checkWhoAmIHelper</span><span class="p">(</span><span class="n">cmdResults</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">str</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">cmdOutputRe</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sshEnvironmentControl</span><span class="p">.</span><span class="n">matchRe</span><span class="p">.</span><span class="k">search</span><span class="p">(</span><span class="w"></span>

<span class="w">                    </span><span class="n">sshEnvironmentControl</span><span class="p">.</span><span class="n">startSubRe</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cmdResults</span><span class="p">,</span><span class="w"> </span><span class="nf">count</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="w"></span>

<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nl">cmdOutputRe</span><span class="p">:</span><span class="w"></span>

<span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="n">sshEnvironmentControl</span><span class="p">.</span><span class="n">endSubRe</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">cmdOutputRe</span><span class="p">.</span><span class="k">group</span><span class="p">(),</span><span class="w"> </span><span class="nf">count</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>

<span class="w">            </span><span class="ow">except</span><span class="w"> </span><span class="k">Exception</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="nf">log</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;error in _checkWhoAmIHelper: {e}&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;[DEBUG] for _checkWhoAmIHelper: {traceback.format_exc()}&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">_checkWhoAmIHelper</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">executeOnEnvironment</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="p">,</span><span class="w"></span>

<span class="w">                                                            </span><span class="n">cmd</span><span class="o">=</span><span class="s1">&#39;echo CMDSTART; whoami; echo CMDEND&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="consoleescalation">consoleEscalation</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">consoleEscalation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">escalationCmd</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">escalationArgs</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">escalationInput</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">escalationType</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;console&#39;</span><span class="p">,</span>
    <span class="n">escalationHook</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Callable</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

<p>This function differs from 'becomeUser' as it designed to change the environment from BASH to for example</p>
<p>mysql shell or a sqlpluss shell.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>escalationCmd</td>
<td>None</td>
<td>(str) - The command such as sqlpluss or zsh</td>
<td>None</td>
</tr>
<tr>
<td>escalationArgs</td>
<td>None</td>
<td>(str) default "" - Additional args such as '-h localhost'.</td>
<td>None</td>
</tr>
<tr>
<td>escalationInput</td>
<td>None</td>
<td>(str) default None - This is used if the command will require input such as a password.</td>
<td>None</td>
</tr>
<tr>
<td>escalationType</td>
<td>None</td>
<td>(str) default "console" - This is used to record the escalation type in sshEnvironment.</td>
<td>None</td>
</tr>
<tr>
<td>escalationHook</td>
<td>None</td>
<td>(Callable) default None - a method to call instead of the default escalation method.</td>
<td>None</td>
</tr>
<tr>
<td>name</td>
<td>None</td>
<td>(str) defualt None - What to call this console change. This can be useful when searching if a</td>
<td></td>
</tr>
<tr>
<td>sshEnvironment has already escalated to a specific environment.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>environment</td>
<td>None</td>
<td>sshEnvironment object</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>Either 'sshEnvironment' (success) or False (Failure)</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">consoleEscalation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">escalationCmd</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="p">,</span><span class="w"> </span><span class="nl">escalationArgs</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">escalationInput</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                          </span><span class="nl">escalationType</span><span class="p">:</span><span class="w"> </span><span class="nf">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;console&quot;</span><span class="p">,</span><span class="w"> </span><span class="nl">escalationHook</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Callable</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                          </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                          </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">sshEnvironment, bool</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This function differs from &#39;becomeUser&#39; as it designed to change the environment from BASH to for example</span>

<span class="ss">            mysql shell or a sqlpluss shell.</span>

<span class="ss">        :param escalationCmd: (str) - The command such as sqlpluss or zsh</span>

<span class="ss">        :param escalationArgs: (str) default &quot;&quot; - Additional args such as &#39;-h localhost&#39;.</span>

<span class="ss">        :param escalationInput: (str) default None - This is used if the command will require input such as a password.</span>

<span class="ss">        :param escalationType: (str) default &quot;</span><span class="n">console</span><span class="ss">&quot; - This is used to record the escalation type in sshEnvironment.</span>

<span class="ss">        :param escalationHook: (Callable) default None - a method to call instead of the default escalation method.</span>

<span class="ss">        :param name: (str) defualt None - What to call this console change. This can be useful when searching if a</span>

<span class="ss">                sshEnvironment has already escalated to a specific environment.</span>

<span class="ss">        :param environment: sshEnvironment object</span>

<span class="ss">        :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">reCapturePrompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="nl">strBuffer</span><span class="p">:</span><span class="w"> </span><span class="n">StringIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">recv_ready</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">True</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">send_ready</span><span class="p">()</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">True</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">closed</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">environment</span><span class="p">.</span><span class="n">get_transport</span><span class="p">().</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">                </span><span class="n">raise</span><span class="w"> </span><span class="n">SSHExceptionChannel</span><span class="p">(</span><span class="s1">&#39;Unable to create SSH channel...&#39;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">sleep</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">escalationCmd</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_performEscalation</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">loginCmd</span><span class="o">=</span><span class="n">escalationCmd</span><span class="p">,</span><span class="w"> </span><span class="n">loginPasswd</span><span class="o">=</span><span class="n">escalationInput</span><span class="p">,</span><span class="w"></span>

<span class="w">                                              </span><span class="n">userName</span><span class="o">=</span><span class="n">escalationArgs</span><span class="p">,</span><span class="w"> </span><span class="n">buffer</span><span class="o">=</span><span class="n">strBuffer</span><span class="p">,</span><span class="w"> </span><span class="n">console</span><span class="o">=</span><span class="k">True</span><span class="p">,</span><span class="w"></span>

<span class="w">                                              </span><span class="n">escalationHook</span><span class="o">=</span><span class="n">escalationHook</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">escalationCmd</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">escalationArgs</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">additionalInput</span><span class="o">=</span><span class="n">escalationInput</span><span class="p">,</span><span class="w"></span>

<span class="w">                         </span><span class="n">escalationType</span><span class="o">=</span><span class="n">escalationType</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="createconn">createConn</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">createConn</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">host</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">AnyStr</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">port</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">AnyStr</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">password</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">AnyStr</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">connTimeout</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">paramiko</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">SSHClient</span>
</code></pre></div>

<p>Creates SSH Object and Opens Connection To Server All the parameters are optional. If a parameter isn't</p>
<p>passed it will pull from the Class variable of the same name. If the parameter is passed it will override
    the class variable before connecting.</p>
<ul>
<li>:param host: (str) - Optional hostname/ip address of the box.</li>
<li>:param port: (int) - Optional port to attempt to make the tcp connection.</li>
<li>:param username: (str) - Optional and will use the class stored variable if not passed.</li>
<li>:param password: (str) - Optional and will use the class stored variable if not passed.</li>
<li>:param connTimeout: (float) - Optional and will use the class stored variable if not passed.</li>
<li>:return: Paramiko SSHClient object. Otherwise known as SSH Connection.</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">createConn</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="k">host</span><span class="err">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">AnyStr</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">port</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">int</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">username</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">AnyStr</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                   </span><span class="nl">password</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">AnyStr</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">connTimeout</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">float</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">SSHClient</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Creates SSH Object and Opens Connection To Server All the parameters are optional. If a parameter isn&#39;t</span>

<span class="ss">            passed it will pull from the Class variable of the same name. If the parameter is passed it will override</span>

<span class="ss">            the class variable before connecting.</span>

<span class="ss">        - :param host: (str) - Optional hostname/ip address of the box.</span>

<span class="ss">        - :param port: (int) - Optional port to attempt to make the tcp connection.</span>

<span class="ss">        - :param username: (str) - Optional and will use the class stored variable if not passed.</span>

<span class="ss">        - :param password: (str) - Optional and will use the class stored variable if not passed.</span>

<span class="ss">        - :param connTimeout: (float) - Optional and will use the class stored variable if not passed.</span>

<span class="ss">        - :return: Paramiko SSHClient object. Otherwise known as SSH Connection.</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">ssh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">ssh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">SSHClient</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">ssh</span><span class="p">.</span><span class="n">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="p">.</span><span class="n">AutoAddPolicy</span><span class="p">())</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="k">host</span><span class="err">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="k">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">host</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">port</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">port</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">username</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">username</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">password</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">password</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">connTimeout</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">self</span><span class="p">.</span><span class="n">connTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connTimeout</span><span class="w"></span>

<span class="w">            </span><span class="n">ssh</span><span class="p">.</span><span class="k">connect</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="k">host</span><span class="p">,</span><span class="w"></span>

<span class="w">                        </span><span class="n">port</span><span class="o">=</span><span class="nc">int</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">port</span><span class="p">),</span><span class="w"></span>

<span class="w">                        </span><span class="n">pkey</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_handleSSHKey</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="k">key</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">),</span><span class="w"></span>

<span class="w">                        </span><span class="n">username</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"></span>

<span class="w">                        </span><span class="n">password</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">password</span><span class="p">,</span><span class="w"></span>

<span class="w">                        </span><span class="n">timeout</span><span class="o">=</span><span class="nc">float</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">connTimeout</span><span class="p">),</span><span class="w"></span>

<span class="w">                        </span><span class="n">look_for_keys</span><span class="o">=</span><span class="k">False</span><span class="p">,</span><span class="w"></span>

<span class="w">                        </span><span class="n">banner_timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">,</span><span class="w"></span>

<span class="w">                        </span><span class="n">sock</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">_makeSockProxy</span><span class="p">())</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="n">error</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">ssh</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">ssh</span><span class="p">.</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">LDTKSSHException</span><span class="p">(</span><span class="s1">&#39;Connection Error for User %s: %s&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">e</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="p">(</span><span class="n">paramiko</span><span class="p">.</span><span class="n">AuthenticationException</span><span class="p">,</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">BadAuthenticationType</span><span class="p">,</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">BadHostKeyException</span><span class="p">,</span><span class="w"></span>

<span class="w">                </span><span class="n">paramiko</span><span class="p">.</span><span class="n">PasswordRequiredException</span><span class="p">,</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">ssh_exception</span><span class="p">.</span><span class="n">PartialAuthentication</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">ssh</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">ssh</span><span class="p">.</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">SSHExceptionAuth</span><span class="p">(</span><span class="s1">&#39;Authentication Error for User %s: %s&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">e</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="p">(</span><span class="n">paramiko</span><span class="p">.</span><span class="n">ssh_exception</span><span class="p">.</span><span class="n">ConfigParseError</span><span class="p">,</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">ProxyCommandFailure</span><span class="p">,</span><span class="w"></span>

<span class="w">                </span><span class="n">paramiko</span><span class="p">.</span><span class="n">ssh_exception</span><span class="p">.</span><span class="n">CouldNotCanonicalize</span><span class="p">,</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">ssh_exception</span><span class="p">.</span><span class="n">NoValidConnectionsError</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">SSHExceptionConn</span><span class="p">(</span><span class="s1">&#39;Could not connect to remove machine for User %s: %s&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">e</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">paramiko</span><span class="p">.</span><span class="n">SSHException</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">ssh</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">ssh</span><span class="p">.</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">SSHExceptionUnknown</span><span class="p">(</span><span class="s1">&#39;Generic Paramiko Exception for User %s: %s&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">e</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="k">Exception</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nl">ssh</span><span class="p">:</span><span class="w"></span>

<span class="w">                </span><span class="n">ssh</span><span class="p">.</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="n">raise</span><span class="w"> </span><span class="n">LDTKSSHException</span><span class="p">(</span><span class="s1">&#39;Unknown Error for User %s: %s&#39;</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">username</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">e</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">ssh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ssh</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">ssh</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="disconnect">disconnect</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>This attempts to graceful log out by exiting/de-escalating through all previous console escalations on a</p>
<p>given sshEnvironment.</p>
<ul>
<li>:param environment: (sshEnvironment) default None -</li>
<li>:return: None</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="k">disconnect</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This attempts to graceful log out by exiting/de-escalating through all previous console escalations on a</span>

<span class="ss">            given sshEnvironment.</span>

<span class="ss">        - :param environment: (sshEnvironment) default None -</span>

<span class="ss">        - :return: None</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">range</span><span class="p">(</span><span class="n">environment</span><span class="p">.</span><span class="n">numEscalations</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">logoutCurrentUser</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="k">False</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">isMain</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">super</span><span class="p">(</span><span class="n">sshEnvironmentControl</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">).</span><span class="k">disconnect</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="environmentchange">environmentChange</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">environmentChange</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

<p>Changes the state of the environment in some way other then user or console escalation. This method</p>
<p>depends on 'consoleEscalation'. It simply adjusted the 'escalationType' and 'reCapturePrompt' parameters
    to work for changing the environment. This method is helpful if you want to record the fact that this
    sshEnvironment has special variables/settings set. Such as editing its PATH or the use of export. That way
    it is easy to run future commands on that particular environment.</p>
<ul>
<li>:param: args - Passed to 'consoleEscalation'</li>
<li>:param: kwargs - Passed to 'consoleEscalation'</li>
<li>:return: Either 'sshEnvironment' (success) or False (Failure)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">environmentChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span><span class="w"> </span><span class="nb nb-Type">bool</span><span class="p">]:</span><span class="w"></span>

<span class="w">        </span><span class="sd">&quot;&quot;&quot; Changes the state of the environment in some way other then user or console escalation. This method</span>

<span class="sd">            depends on &#39;consoleEscalation&#39;. It simply adjusted the &#39;escalationType&#39; and &#39;reCapturePrompt&#39; parameters</span>

<span class="sd">            to work for changing the environment. This method is helpful if you want to record the fact that this</span>

<span class="sd">            sshEnvironment has special variables/settings set. Such as editing its PATH or the use of export. That way</span>

<span class="sd">            it is easy to run future commands on that particular environment.</span>

<span class="sd">        - :param: args - Passed to &#39;consoleEscalation&#39;</span>

<span class="sd">        - :param: kwargs - Passed to &#39;consoleEscalation&#39;</span>

<span class="sd">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="sd">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;escalationType&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;env&#39;</span><span class="w"></span>

<span class="w">        </span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reCapturePrompt&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">False</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">consoleEscalation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="escalate">escalate</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">escalate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="n">env</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">console</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

<p>The default escalation method. This can handle console or environment changes. It uses the console</p>
<p>and env bool parameters to control what type of console change will happen. If both are false the method
    will call the 'becomeUser' method.</p>
<ul>
<li>:param args: (tuple) - passed on</li>
<li>:param env: (bool) default False - This will be checked first and will call 'environmentChange' method.</li>
<li>:param console: (bool) default False - This will be checked second and will call 'consoleEscalation' method.</li>
<li>:param kwargs: (dict) - passed on</li>
<li>:return: Either 'sshEnvironment' (success) or False (Failure)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">escalate</span><span class="p">(</span><span class="kr">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="n">env</span><span class="o">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">False</span><span class="p">,</span><span class="w"> </span><span class="n">console</span><span class="o">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kr">False</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Union</span><span class="p">[</span><span class="n">sshEnvironment</span><span class="p">,</span><span class="w"> </span><span class="n">bool</span><span class="p">]</span><span class="o">:</span><span class="w"></span>

<span class="w">        </span><span class="s">&quot;&quot;&quot; The default escalation method. This can handle console or environment changes. It uses the console</span>

<span class="s">            and env bool parameters to control what type of console change will happen. If both are false the method</span>

<span class="s">            will call the &#39;</span><span class="n">becomeUser</span><span class="s">&#39; method.</span>

<span class="s">        - :param args: (tuple) - passed on</span>

<span class="s">        - :param env: (bool) default False - This will be checked first and will call &#39;</span><span class="n">environmentChange</span><span class="s">&#39; method.</span>

<span class="s">        - :param console: (bool) default False - This will be checked second and will call &#39;</span><span class="n">consoleEscalation</span><span class="s">&#39; method.</span>

<span class="s">        - :param kwargs: (dict) - passed on</span>

<span class="s">        - :return: Either &#39;</span><span class="n">sshEnvironment</span><span class="s">&#39; (success) or False (Failure)</span>

<span class="s">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="nf">if</span><span class="w"> </span><span class="n">kwargs</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;environment&#39;</span><span class="p">,</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="p">)</span><span class="o">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">if</span><span class="w"> </span><span class="n">env</span><span class="o">:</span><span class="w"></span>

<span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">environmentChange</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">elif</span><span class="w"> </span><span class="n">console</span><span class="o">:</span><span class="w"></span>

<span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">consoleEscalation</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">else</span><span class="o">:</span><span class="w"></span>

<span class="w">                </span><span class="kr">return</span><span class="w"> </span><span class="kr">self</span><span class="p">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="kr">return</span><span class="w"> </span><span class="kr">False</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="executeonenvironment">executeOnEnvironment</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">executeOnEnvironment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">EnvironmentControls</span><span class="p">,</span>
    <span class="n">cmd</span><span class="p">:</span> <span class="o">~</span><span class="n">AnyStr</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">AnyStr</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">unsafe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="o">~</span><span class="n">AnyStr</span>
</code></pre></div>

<p>This injects the string into the buffer while trying to ensure there is a prompt. As the prompt is used to</p>
<p>quickly determine the end of the buffer. The prompt can be a string or it can be a tuple of strings that
    attempt to match the end of the line. Unsafe ignores the prompt and simply executes the command and only
    waits a short time before leaving not caring if it got output of the command. This is unsafe as it can leave
    a buffer open ready to dump more output. This method also takes the output from the command and attempts to
    decode it to utf-8 while removing all null and escape characters.</p>
<ul>
<li>:param channel: (Paramiko Channel/sshEnvironment) -</li>
<li>:param cmd: (str) -</li>
<li>:param prompt: (tuple or str) -</li>
<li>:param unsafe: (bool) default False -</li>
<li>:param kwargs:</li>
<li>:return: (str)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">executeOnEnvironment</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">EnvironmentControls</span><span class="p">,</span><span class="w"> </span><span class="nl">cmd</span><span class="p">:</span><span class="w"> </span><span class="n">AnyStr</span><span class="p">,</span><span class="w"></span>

<span class="w">                             </span><span class="nl">prompt</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">Union[AnyStr, Tuple</span><span class="o">]</span><span class="err">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">unsafe</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"></span>

<span class="w">                             </span><span class="nl">reCapturePrompt</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">AnyStr</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This injects the string into the buffer while trying to ensure there is a prompt. As the prompt is used to</span>

<span class="ss">            quickly determine the end of the buffer. The prompt can be a string or it can be a tuple of strings that</span>

<span class="ss">            attempt to match the end of the line. Unsafe ignores the prompt and simply executes the command and only</span>

<span class="ss">            waits a short time before leaving not caring if it got output of the command. This is unsafe as it can leave</span>

<span class="ss">            a buffer open ready to dump more output. This method also takes the output from the command and attempts to</span>

<span class="ss">            decode it to utf-8 while removing all null and escape characters.</span>

<span class="ss">        - :param channel: (Paramiko Channel/sshEnvironment) -</span>

<span class="ss">        - :param cmd: (str) -</span>

<span class="ss">        - :param prompt: (tuple or str) -</span>

<span class="ss">        - :param unsafe: (bool) default False -</span>

<span class="ss">        - :param kwargs:</span>

<span class="ss">        - :return: (str)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">def</span><span class="w"> </span><span class="n">_parseOutput</span><span class="p">(</span><span class="n">tmpOut</span><span class="p">,</span><span class="w"> </span><span class="n">tmpPrompt</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">tmpOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sshBufferControl</span><span class="p">.</span><span class="n">_decodeStringEscape</span><span class="p">(</span><span class="n">tmpOut</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">tmpOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sshBufferControl</span><span class="p">.</span><span class="n">escapeChars</span><span class="p">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">tmpOut</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">tmpOut</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">tmpPrompt</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="n">strip</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">super</span><span class="p">(</span><span class="n">sshBufferControl</span><span class="p">,</span><span class="w"> </span><span class="n">self</span><span class="p">).</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">sshChannel</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;There is not valid connection.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>

<span class="w">        </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Attempting to exec command[s]: {cmd}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">isinstance</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span><span class="w"> </span><span class="nf">str</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sshBufferControl</span><span class="p">.</span><span class="n">_decodeStringEscape</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">unsafe</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">False</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">try</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">cmd</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="p">,</span><span class="w"> </span><span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span><span class="w"> </span><span class="n">unsafe</span><span class="o">=</span><span class="n">unsafe</span><span class="p">,</span><span class="w"> </span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseOutput</span><span class="p">(</span><span class="k">out</span><span class="p">.</span><span class="n">getvalue</span><span class="p">(),</span><span class="w"> </span><span class="n">prompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">RecvReady</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nl">e</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;The timeout of {self.runTimeout} was reached while waiting for prompt on buffer.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;[DEBUG] for executeOnEnvironment: {traceback.format_exc()}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_parseOutput</span><span class="p">(</span><span class="k">out</span><span class="p">.</span><span class="n">getvalue</span><span class="p">(),</span><span class="w"> </span><span class="n">prompt</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">environment</span><span class="p">.</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="ow">except</span><span class="w"> </span><span class="n">socket</span><span class="p">.</span><span class="nl">timeout</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">error</span><span class="p">(</span><span class="ss">&quot;Timeout exception found.&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;[COMMAND_IO_LIMIT_TIMED_OUT]&#39;</span><span class="w"></span>

<span class="w">            </span><span class="n">environment</span><span class="p">.</span><span class="k">close</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="nl">finally</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">out</span><span class="p">.</span><span class="k">truncate</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">del</span><span class="w"> </span><span class="k">out</span><span class="w"></span>

<span class="w">            </span><span class="err">#</span><span class="w"> </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;The output of the cmd: {cmd} is: \n===\n{output}\n===&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">output</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="getprompt">getPrompt</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">getPrompt</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span>
    <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>
</code></pre></div>

<p>This captures the current prompt which is used to improve the performance of the buffer.</p>
<ul>
<li>:param environment: sshEnvironment object</li>
<li>:return: str or None</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">getPrompt</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">sshEnvironment</span><span class="p">,</span><span class="w"> </span><span class="nl">reCapturePrompt</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">False</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This captures the current prompt which is used to improve the performance of the buffer.</span>

<span class="ss">        - :param environment: sshEnvironment object</span>

<span class="ss">        - :return: str or None</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="err">#</span><span class="w"> </span><span class="nf">log</span><span class="p">.</span><span class="n">debug</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;ID: {environment._id} - Cached Prompt: {environment.prompt} - reCapturePrompt: {reCapturePrompt}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">prompt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">reCapturePrompt</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">False</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">prompt</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="p">.</span><span class="n">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">_capturePrompt</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">StringIO</span><span class="p">())</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">None</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">prompt</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="logoutconsole">logoutConsole</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">logoutConsole</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">logoutCmd</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

<p>This reverses through past environment changes until it undoes the previous console escalation.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>logoutCmd</td>
<td>None</td>
<td>(str) (default None) This is a custom command to leave the console. For example 'exit' or</td>
<td></td>
</tr>
<tr>
<td>'quit'.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>environment</td>
<td>None</td>
<td>(sshEnvironment/Paramiko Channel)</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td></td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">logoutConsole</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">logoutCmd</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">str</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nl">bool</span><span class="p">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This reverses through past environment changes until it undoes the previous console escalation.</span>

<span class="ss">        :param logoutCmd: (str) (default None) This is a custom command to leave the console. For example &#39;exit&#39; or</span>

<span class="ss">            &#39;quit&#39;.</span>

<span class="ss">        :param environment: (sshEnvironment/Paramiko Channel)</span>

<span class="ss">        :return:</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">logoutCmd</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="n">logoutCmd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ss">&quot;exit&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;exit&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">StringIO</span><span class="p">(),</span><span class="w"> </span><span class="n">unsafe</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">pull</span><span class="p">()</span><span class="o">[</span><span class="n">0</span><span class="o">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="nl">__CONSOLE_ESCALATION__</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">logoutConsole</span><span class="p">(</span><span class="n">logoutCmd</span><span class="p">,</span><span class="w"> </span><span class="n">environment</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">checkConnection</span><span class="p">()</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="logoutcurrentuser">logoutCurrentUser</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">logoutCurrentUser</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">junkOut</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">reCapturePrompt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

<p>Runs the command 'exit' once on a specified environment. Effectively logging out of a user or other</p>
<p>escalation.</p>
<ul>
<li>:param environment: (sshEnvironment) default None -</li>
<li>:param junkOut: (StringIO) default None -</li>
<li>:param reCapturePrompt: (bool) default True -</li>
<li>:return: Either 'sshEnvironment' (success) or False (Failure)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">logoutCurrentUser</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"> </span><span class="nl">junkOut</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">StringIO</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">,</span><span class="w"></span>

<span class="w">                          </span><span class="nl">reCapturePrompt</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">True</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="ow">Union</span><span class="o">[</span><span class="n">sshEnvironment, bool</span><span class="o">]</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; Runs the command &#39;exit&#39; once on a specified environment. Effectively logging out of a user or other</span>

<span class="ss">            escalation.</span>

<span class="ss">        - :param environment: (sshEnvironment) default None -</span>

<span class="ss">        - :param junkOut: (StringIO) default None -</span>

<span class="ss">        - :param reCapturePrompt: (bool) default True -</span>

<span class="ss">        - :return: Either &#39;sshEnvironment&#39; (success) or False (Failure)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">environment</span><span class="p">.</span><span class="n">consoleStack</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">None</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="nf">len</span><span class="p">(</span><span class="n">environment</span><span class="p">.</span><span class="n">consoleStack</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="nl">junkOut</span><span class="p">:</span><span class="w"></span>

<span class="w">            </span><span class="nl">junkOut</span><span class="p">:</span><span class="w"> </span><span class="n">StringIO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">StringIO</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="n">self</span><span class="p">.</span><span class="n">_bufferControl</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;exit&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">junkOut</span><span class="p">,</span><span class="w"> </span><span class="n">unsafe</span><span class="o">=</span><span class="k">True</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="n">environment</span><span class="p">.</span><span class="n">pull</span><span class="p">()</span><span class="w"></span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">checkConnection</span><span class="p">(</span><span class="n">environment</span><span class="p">)</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Connection still valid on: {environment._id} - Num Escalations: {environment.numEscalations}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">            </span><span class="n">self</span><span class="p">.</span><span class="n">getPrompt</span><span class="p">(</span><span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">,</span><span class="w"> </span><span class="n">reCapturePrompt</span><span class="o">=</span><span class="n">reCapturePrompt</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">else</span><span class="err">:</span><span class="w"></span>

<span class="w">            </span><span class="nf">log</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">f</span><span class="ss">&quot;Connection closed on: {environment._id}&quot;</span><span class="p">)</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">environment</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="resetenvironment">resetEnvironment</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">resetEnvironment</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

<p>As noted by the name this resets the values for the sshEnvironment class. <em>BE CAREFUL</em> this doesn't run</p>
<p>commands on the ssh channel environment meaning the actual environment on the target machine hasn't
    changed. This only clears the values recorded on the sshEnvironment class.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>environment</td>
<td>None</td>
<td>(sshEnvironment) default None - the sshEnvironment to run 'resetEnvironment' against.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">resetEnvironment</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="k">None</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; As noted by the name this resets the values for the sshEnvironment class. *BE CAREFUL* this doesn&#39;t run</span>

<span class="ss">            commands on the ssh channel environment meaning the actual environment on the target machine hasn&#39;t</span>

<span class="ss">            changed. This only clears the values recorded on the sshEnvironment class.</span>

<span class="ss">        :param environment: (sshEnvironment) default None - the sshEnvironment to run &#39;resetEnvironment&#39; against.</span>

<span class="ss">        :return: None</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="n">getattr</span><span class="p">(</span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;resetEnvironment&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">dummy_func</span><span class="p">)()</span><span class="w"></span>
</code></pre></div>

</details>
<h4 id="whoami">whoami</h4>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">whoami</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">environment</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">sshConnector</span><span class="o">.</span><span class="n">sshLibs</span><span class="o">.</span><span class="n">sshChannelEnvironment</span><span class="o">.</span><span class="n">sshEnvironment</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

<p>This returns the 'whoami' of the provided sshEnvironment. If an environment is not provided it pulls this</p>
<p>from the main Environment. Sense this is looking at a variable this is not always reliable because the
    variable may become de-synced with its actual environment. Also calling this from a thread may also result
    in the wrong information if the environment is also being acted upon. For accurate information use the
    'checkWhoAmI' method as this runs the 'whoami' command on sshEnvironment.</p>
<ul>
<li>:param environment: (sshEnvironment) default None -</li>
<li>:return (str)</li>
</ul>
<details class="example"><summary>View Source</summary><div class="codehilite"><pre><span></span><code><span class="w">    </span><span class="n">def</span><span class="w"> </span><span class="n">whoami</span><span class="p">(</span><span class="n">self</span><span class="p">,</span><span class="w"> </span><span class="nl">environment</span><span class="p">:</span><span class="w"> </span><span class="n">Optional</span><span class="o">[</span><span class="n">sshEnvironment</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">None</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nf">str</span><span class="err">:</span><span class="w"></span>

<span class="w">        </span><span class="ss">&quot;&quot;&quot; This returns the &#39;whoami&#39; of the provided sshEnvironment. If an environment is not provided it pulls this</span>

<span class="ss">            from the main Environment. Sense this is looking at a variable this is not always reliable because the</span>

<span class="ss">            variable may become de-synced with its actual environment. Also calling this from a thread may also result</span>

<span class="ss">            in the wrong information if the environment is also being acted upon. For accurate information use the</span>

<span class="ss">            &#39;checkWhoAmI&#39; method as this runs the &#39;whoami&#39; command on sshEnvironment.</span>

<span class="ss">        - :param environment: (sshEnvironment) default None -</span>

<span class="ss">        - :return (str)</span>

<span class="ss">        &quot;&quot;&quot;</span><span class="w"></span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">getattr</span><span class="p">(</span><span class="n">environment</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">self</span><span class="p">.</span><span class="n">mainEnvironment</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;whoami&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../sshConnect/" title="Sshconnect" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Sshconnect
              </span>
            </div>
          </a>
        
        
          <a href="../sshEnvironmentManager/" title="Sshenvironmentmanager" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Sshenvironmentmanager
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>