
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.5.4">
    
    
      
        <title>PyLinuxDiagnosticToolKit</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.80dcb947.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#4cae4f">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pylinuxdiagnostictoolkit" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="PyLinuxDiagnosticToolKit" class="md-header__button md-logo" aria-label="PyLinuxDiagnosticToolKit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyLinuxDiagnosticToolKit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Summary
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/orcephrye/PyLinuxDiagnosticToolKit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyLinuxDiagnosticToolKit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="PyLinuxDiagnosticToolKit" class="md-nav__button md-logo" aria-label="PyLinuxDiagnosticToolKit" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PyLinuxDiagnosticToolKit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/orcephrye/PyLinuxDiagnosticToolKit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyLinuxDiagnosticToolKit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="." class="md-nav__link md-nav__link--active">
        Summary
      </a>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="TUTORIAL/" class="md-nav__link">
        Tutorial
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="PyLinuxDiagnosticToolKit/sshConnector/" class="md-nav__link">
        sshConnector
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="PyLinuxDiagnosticToolKit/LinuxModules/" class="md-nav__link">
        CommandContainer
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/CommandContainers/" class="md-nav__link">
        Commandcontainers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/SCPChannel/" class="md-nav__link">
        Scpchannel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/SFTPChannel/" class="md-nav__link">
        Sftpchannel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/genericCmdModule/" class="md-nav__link">
        Genericcmdmodule
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/ldtk/" class="md-nav__link">
        Ldtk
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/sshBufferControl/" class="md-nav__link">
        Sshbuffercontrol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/sshChannelEnvironment/" class="md-nav__link">
        Sshchannelenvironment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/sshConnect/" class="md-nav__link">
        Sshconnect
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/sshEnvironmentControl/" class="md-nav__link">
        Sshenvironmentcontrol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/sshEnvironmentManager/" class="md-nav__link">
        Sshenvironmentmanager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="reference/sshThreader/" class="md-nav__link">
        Sshthreader
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/orcephrye/PyLinuxDiagnosticToolKit/edit/main/README.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="pylinuxdiagnostictoolkit">PyLinuxDiagnosticToolKit</h1>
<hr />
<p><a href="https://choosealicense.com/licenses/gpl-3.0/"><img alt="License: GPL v3" src="https://img.shields.io/badge/License-GPLv3-blue.svg" /></a>
<a href="https://orcephrye.github.io/PyLinuxDiagnosticToolKit/"><img alt="Docs" src="https://readthedocs.org/projects/ansicolortags/badge/?version=latest" /></a></p>
<p>Wiki can be viewed on GitHub Pages. 
URL: https://orcephrye.github.io/PyLinuxDiagnosticToolKit/</p>
<p>These documentation pages are made by Portray: https://timothycrosley.github.io/portray/</p>
<ul>
<li>REQUIRES: Python 3.7+, PyMultiTasking, PyCustomParsers, PyCustomCollections and Paramiko</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="c1"># Install requirements (pip should point to a Python 3.7+ environment.)</span>
pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
<span class="c1"># Install the whole package</span>
pip<span class="w"> </span>install<span class="w"> </span>.
</code></pre></div>

<p><strong>The Linux Diagnostic Tool Kit:</strong></p>
<hr />
<p>This is a set of Modules (python packages) themed after linux commands or programs, packaged together with some tools to
interact with a remote machine. Currently, the only 'connector' is the 'sshConnector' which provides connectivity too 
Linux machines. The tools, connectors, and modules are tied together by the ToolKitInterface class in the ldtk.py 
package. </p>
<p>The ToolKitInterface class should be the primary class a python script interacts with. It is as simple as importing 
the package and instantiating an object.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">PyLinuxDiagnosticToolKit.ldtk</span> <span class="kn">import</span> <span class="n">ToolKitInterface</span>
<span class="n">tki</span> <span class="o">=</span> <span class="n">ToolKitInterface</span><span class="p">()</span>
</code></pre></div>

<p>In order to get login information the TKI uses the ArgumentWrapper package. This is a highly customizable NamespaceDict 
object. If you are not creating a callable script but utilizing this program within an environment like ipython then 
you will need too pass the ArgumentWrapper manually.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">PyLinuxDiagnosticToolKit.libs</span> <span class="kn">import</span> <span class="n">ArgumentWrapper</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">ArgumentWrapper</span><span class="o">.</span><span class="n">arguments</span><span class="p">()</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">args</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">;</span> <span class="n">args</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;server&#39;</span><span class="p">;</span> <span class="n">args</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;abc123&#39;</span><span class="p">;</span> <span class="n">args</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">args</span><span class="o">.</span><span class="n">rootpwd</span> <span class="o">=</span> <span class="s1">&#39;abc123&#39;</span>
<span class="n">tki</span> <span class="o">=</span> <span class="n">ToolKitInterface</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>

<p>or</p>
<div class="codehilite"><pre><span></span><code><span class="n">args</span> <span class="o">=</span> <span class="n">ArgumentWrapper</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="s2">&quot;--host 127.0.0.1 --username server --password abc123 -r --rootpwd abc123&quot;</span><span class="p">)</span>
<span class="n">tki</span> <span class="o">=</span> <span class="n">ToolKitInterface</span><span class="p">(</span><span class="n">arguments</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Note: There is a massive list of possible arguments please review the ArgumentWrapper for all possible options. Also, 
you do not necessarily need to provide it the exact class with all arguments. Simply any NamespaceDict object will do. </p>
</blockquote>
<p>For more information on Argument Wrapper please review its readme file: <a href="../LST_LinuxDiagnosticToolKit/ArgumentWrapper" title="Arguments README">tutorial</a></p>
<p><strong><em>Execute Commands:</em></strong></p>
<hr />
<p>From here if a dev wants to run a custom command it is as simple as:</p>
<div class="codehilite"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;whoami&quot;</span><span class="p">,</span> <span class="n">threading</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>

<p>or</p>
<div class="codehilite"><pre><span></span><code><span class="n">cc</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;whoami&quot;</span><span class="p">,</span> <span class="n">threading</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Threading is True by default</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">waitForResults</span><span class="p">()</span>  
<span class="nb">print</span><span class="p">(</span><span class="n">cc</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>  <span class="c1"># This demonstrates that the &#39;CommandContainer&#39; object also stores the results</span>
</code></pre></div>

<p>Execute returns a CommandContainer if threading is True. If Threading is false then it returns the output of the
command as a string. We will get to how to use CommandContainer later.</p>
<p>For a full explanation go to the <a href="../LST_LinuxDiagnosticToolKit/LinuxModules/" title="CommandContainer">CommandContainer</a> page.</p>
<p><strong>Modules:</strong></p>
<hr />
<p>Currently, there are only 'LinuxModulse' which contain 'CommandModules', 'OtherModules', and 'ProgramModules'. 
Eventually These will be reorganized once Windows is supported.</p>
<ul>
<li>Command Modules are common Linux specific commands (i.e: cat, ps, etc...)</li>
<li>Program Modules are programs that run on the target remote OS. (i.e: MySQL, Oracle, etc...)</li>
</ul>
<p>To get a list of modules use the 'getAvailableModules' method. This returns a list of strings that represent the 
supported commands.</p>
<div class="codehilite"><pre><span></span><code><span class="go">from PyLinuxDiagnosticToolKit.ldtk import ToolKitInterface</span>
<span class="go">tki = ToolKitInterface()</span>
<span class="go">tki.getAvailableModules()</span>
</code></pre></div>

<p>Any command regardless if it is present in the list of supported modules can be executed via the 'execute' method. 
Modules are a more 'pythonic' or programmatic way of handling shell commands. They also can have special methods 
specific to the nature of the command they represent. An example of this would be 'ps' command module having a method 
'getTopCPU' or the 'll' module which has the method 'fileExist'. </p>
<p>Also not all modules directly map too a single command. Some modules use multiple commands together when using a certain
methods while others are a collection of commands following a particular theme. An example of this would be the 'touch'
modules 'isWritable' method which determines if a filesystem can be written too. It also uses the 'rm' module. While
the service module combines the commands service, chkconfig, and systemctl all in one.</p>
<p><strong>The CommandModules:</strong></p>
<p>These command modules are packages that all inherit from genericCmdModule and they are themed around certain bash
commands. For example the psmodule uses the 'ps' command and has custom parsing tools to handle the output.</p>
<p>To use a module:</p>
<div class="codehilite"><pre><span></span><code><span class="n">ps</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">getModule</span><span class="p">(</span><span class="s1">&#39;ps&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">(</span><span class="n">rerun</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">rerun</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">(</span><span class="s1">&#39;-ef&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">ef</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="o">.</span><span class="n">getTopCPU</span><span class="p">())</span>
</code></pre></div>

<p>The first command creates an instance of the psmodule and makes it aware of the ToolKitInterface.</p>
<p>The second command simply runs the 'ps' with default flags. Review the module itself or if in ipython simply run: 'ps?'.</p>
<p>All results of commands are cached. So the 'rerun' parameter is a standard option to tell the method to rerun the 
command on the remote target even if the object already has results for that command. In the case of the 'ps' command 
the rerun flag defaults too True. Most command modules the 'rerun' parameter is False.</p>
<p>All commands run on a spawned worker thread that represents a Paramiko SSH Channel. The parameter wait is uses to tell 
the method how long it is acceptable to wait for data back. If the command is not yet finished it doesn't stop running
the method simply returns None. If wait is None then the method will return a CommandObject if its running a new 
command or a cached results.</p>
<p>The arguments '-ef' are considered custom flags. The ps module will then bypass normal behavior and simply run 'ps -ef'. 
This still means the results will be cached and the standard parameters are accepted.</p>
<p>The method 'getTopCPU' was added to the psModule to parse the ps data in a common way. There are lots of these 'helper' 
methods across a lot of the Modules. </p>
<blockquote>
<p>Note: Threading can be tricky and may cause unexpected behavior. For example if you run 'cat('/etc/hosts')' ten times 
in a loop it will not spin up 10 cat commands but actually just one. It will run the first command to completion and 
then the remaining 9 will return the cache result. If you run it with 'wait=None' the cache process is thread safe so 
the first cat command will return the CommandObject which will be the same CommandObject for the remaining 9 runs.
However, if you have that same loop run ten different cat commands (ie: cat /tmp/hosts, cat /etc/resolv.conf, etc...) 
commands (with wait=None) it will run all 10 in as many threads as is allowed. (default is 8). If you want the same 
command to run over and over again the flag 'rerun' can be set to True. If 'wait' is set to anything other than None it
is considering 'blocking' and will wait until either the command is finished or the wait time is reached.</p>
</blockquote>
<p><strong>The SCP and SFTP:</strong></p>
<hr />
<blockquote>
<p>Getting and using a SFTP connection</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">sftp</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">getSFTPClient</span><span class="p">()</span>
<span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/path/too/file.out&#39;</span><span class="p">,</span> <span class="s1">&#39;/remote/path/too/new/filename&#39;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Getting and using a SCP connection </p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">scp</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">getSCPClient</span><span class="p">()</span>
<span class="n">scp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/path/too/file.out&#39;</span><span class="p">,</span> <span class="s1">&#39;/remote/path/too/new/filename&#39;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>SCP and SFTP can use 'with'</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="k">with</span> <span class="n">tki</span><span class="o">.</span><span class="n">getSFTPClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
    <span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">&#39;/path/too/file.out&#39;</span><span class="p">,</span> <span class="s1">&#39;/remote/path/too/new/filename&#39;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Both SCP and SFTP can handle IO and file objects</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="n">sIO</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">(</span><span class="s2">&quot;Some file saved in memory as a str&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">tki</span><span class="o">.</span><span class="n">getSFTPClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">sftp</span><span class="p">:</span>
    <span class="n">sftp</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">sIO</span><span class="p">,</span> <span class="s1">&#39;/remote/path/too/new/filename&#39;</span><span class="p">)</span>
</code></pre></div>

<p><strong>The sshConnector:</strong></p>
<hr />
<p>This is more 'under the hood' stuff that is likely not necessary for most automation. The ssh Connector is a wrapper
around Paramiko and adds extra functionality to make managing users and extra channels and sftp connections.</p>
<p>A few things to note is how to escalate too a specific user, change environment and how to make custom channels and run
commands on them.</p>
<p>Many methods have an optional parameter 'environment' that allows the programmer to specify a ssh channel to act on. 
By default environment=None and thus any are done to whatever SSH channel is available.</p>
<blockquote>
<p>Escalate too root (if the correct information is already passed in via arguments to the script)</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">becomeRoot</span><span class="p">()</span>
<span class="n">tki</span><span class="o">.</span><span class="n">becomeRoot</span><span class="p">(</span><span class="n">environment</span><span class="o">=&lt;</span><span class="n">sshEnvironment</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Escalate too root (with custom options, this also works for any other user)</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;abc123&#39;</span><span class="p">,</span> <span class="n">loginCmd</span><span class="o">=</span><span class="s1">&#39;sudo&#39;</span><span class="p">)</span>
<span class="n">tki</span><span class="o">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;abc123&#39;</span><span class="p">,</span> <span class="n">loginCmd</span><span class="o">=</span><span class="s1">&#39;sudo&#39;</span><span class="p">,</span> <span class="n">environment</span><span class="o">=&lt;</span><span class="n">ChannelObject</span><span class="o">&gt;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Escalate to root before executing a command without dealing with environment directly using the standard root keyword.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">cc</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>NOTE: There is an argument in the ArgumentWrapper '-r' or '--root' the default is False. If passed the script will 
always automatically attempt to run the 'becomeRoot' method.</p>
<p>NOTE: The TKI is aware of sudo's ability to cache creds, and is also aware of sudo requesting different passwords 
such as 'server'. When uses 'sudo' it uses 'sudo -k'. It also is aware when 'sudo' asks for the password of a different 
user. It can look at the password for the requested user. It will also attempt to retry using different methods like 
'su -' and if that failed then 'sudo su -'. This behavior is controled with the '--rootLoginExplicit' flag.</p>
<p>Escalate too a different console, environment param optional</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">consoleEscalation</span><span class="p">(</span><span class="s1">&#39;bash&#39;</span><span class="p">,</span> <span class="s1">&#39;-norc&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BASH&#39;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Change an environment variable, environment param optional</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">environmentChange</span><span class="p">(</span><span class="s2">&quot;export=CHEESE=&#39;blah&#39;&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cheese&#39;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Creating a custom channel to then mess with.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">environment</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">createEnvironment</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;cheese&#39;</span><span class="p">)</span>
<span class="n">tki</span><span class="o">.</span><span class="n">becomeUser</span><span class="p">(</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;abc123&#39;</span><span class="p">,</span> <span class="n">loginCmd</span><span class="o">=</span><span class="s1">&#39;sudo&#39;</span><span class="p">,</span> <span class="n">environment</span><span class="o">=</span><span class="n">environment</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Run a command on your customer channel.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="n">labelReq</span><span class="o">=</span><span class="s1">&#39;cheese&#39;</span><span class="p">)</span>
</code></pre></div>

<blockquote>
<p>Also with a commandModule</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">ps</span><span class="p">(</span><span class="n">rerun</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">labelReq</span><span class="o">=</span><span class="s1">&#39;cheese&#39;</span><span class="p">))</span>
</code></pre></div>

<p>So why don't we pass the environment directly into execute or simpleExecute? Well this is because you can make multi
channels with the same label. Each with an identical environment and then run possibly 100s of commands each one finding
a thread/channel pair to execute on. </p>
<p><strong>The CommandContainer:</strong></p>
<hr />
<p>This is where a lot of the heaving lifting for command execution happens. These objects are thread safe and
customizable.</p>
<p>So far we have only shown what it looks like to run a single command. However, TKI can run hundreds of commands all in
specific order, all aware of each other, and all customizable in the middle of execution, while also all still being
thread safe and simple.</p>
<p>List/Tuples are ordered data types and imply a queue and thus commands in a list or tuple run sequentially. Dict/Set 
are unordered data types and imply a batch and run asynchronously. </p>
<p>Examples:</p>
<blockquote>
<p>An Que of commands that will run one at a time.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">])</span>
</code></pre></div>

<blockquote>
<p>batch of commands that will run all at once.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">({</span><span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">})</span>
</code></pre></div>

<blockquote>
<p>A Que of commands with custom arguments.</p>
</blockquote>
<div class="codehilite"><pre><span></span><code><span class="n">queCmds</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;whoami&#39;</span><span class="p">,</span> <span class="s1">&#39;commandKey&#39;</span><span class="p">:</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;preparser&#39;</span><span class="p">:</span> <span class="n">_someMethod</span><span class="p">},</span>
               <span class="p">{</span><span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;commandKey&#39;</span><span class="p">:</span> <span class="s1">&#39;userInfo&#39;</span><span class="p">,</span> <span class="s1">&#39;preparser&#39;</span><span class="p">:</span> <span class="n">_someOtherMethod</span><span class="p">}]</span>
<span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">queCmds</span><span class="p">)</span>
</code></pre></div>

<p>The CommandContainer is explained in more detail in the documentation for it. In most cases you will never need its more
advanced features.</p>
<p><strong>Threading:</strong></p>
<hr />
<p>The ToolKitInterface and specifically the sshConnector handles threading. This tool uses the 'threading' module within 
Python. This means it doesn't handle multipleprocess nor does it work with asyncio modules. Threading is acceptable 
because the CPU bound commands happen on a remote machine. This could technically benefit from asyncio however 
Paramiko doesn't support async as of writing this.</p>
<p>Below are some ways to interact with this threaded environment. </p>
<p>Firstly when executing a command with the 'execute' method it will return a CommandContainer from the 
'CommandContainers' package. This is a thread safe object that acts like a task or container where the command and its
results are stored. You can string multiple commands together and wait on each of them individually or use a method 
like 'waitForIdle'. Methods that wait on threads will return a None by default implying that the thread is not yet 
finished. You can change this behavior with parameters.</p>
<div class="codehilite"><pre><span></span><code><span class="n">cmd1</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cmd1</span><span class="o">.</span><span class="n">waitForResults</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;w output: </span><span class="si">{</span><span class="n">cmd1</span><span class="o">.</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>

<p>or...</p>
<div class="codehilite"><pre><span></span><code><span class="n">cmd1</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">cmd2</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;ps awux&#39;</span><span class="p">)</span>
<span class="n">tki</span><span class="o">.</span><span class="n">waitForIdle</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;W output: </span><span class="si">{</span><span class="n">cmd1</span><span class="o">.</span><span class="n">results</span><span class="si">}</span><span class="se">\n</span><span class="s2">ps awux output: </span><span class="si">{</span><span class="n">cmd2</span><span class="o">.</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>

<p>If you are using command modules the default value for 'wait' in the parameters is 60. This means each command ran will
run one at a time finishing or at least waiting for 60 seconds before continuing to the next. 'wait' can be set to 
False or 0. That way multiple commands from the CommandModules can be ran asynchronously. Setting 'wait' too False will 
return a CC (CommandContainer) while a 0 will return a None. The CC is created but cached on the module object and can 
be retrived by running the method again.</p>
<div class="codehilite"><pre><span></span><code><span class="n">w</span><span class="p">,</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">getModules</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">)</span>
<span class="n">cmd1</span> <span class="o">=</span> <span class="n">w</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ps</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">tki</span><span class="o">.</span><span class="n">waitForIdle</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;W output: </span><span class="si">{</span><span class="n">cmd1</span><span class="o">.</span><span class="n">results</span><span class="si">}</span><span class="se">\n</span><span class="s2">ps awux output: </span><span class="si">{</span><span class="n">ps</span><span class="p">()</span><span class="si">}</span><span class="s2">)</span>
</code></pre></div>

<p>By default the max aloud threads, and thus ssh channels for the ThreadingPool to manage is determined by the the 
'MaxSessions' variable in the '/etc/ssh/sshd_conf' configuration file on the target machine. This value is retrieved 
when the sshConnector first connects to a target box. It will default to 8 if it fails to get the value.</p>
<p>There is also running Ques and Batches. In this case the returning CommandContainer has a list/set of 'children' which
all have there data. A list/tuple of commands is treated as a queue of commands and thus is executed sequentially while
a Dictionary/Set of commands is treated as a batch of commands and thus are executed asynchronously.</p>
<p>This example takes roughly 15 seconds:</p>
<div class="codehilite"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s1">&#39;sleep(5); echo &quot;one&quot;&#39;</span><span class="p">,</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="n">echo</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="n">echo</span> <span class="s2">&quot;three&quot;</span><span class="p">])</span>
<span class="n">results</span><span class="o">.</span><span class="n">waitForResults</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>

<p>This example takes roughly 5 seconds:</p>
<div class="codehilite"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="n">tki</span><span class="o">.</span><span class="n">execute</span><span class="p">({</span><span class="s1">&#39;sleep(5); echo &quot;one&quot;&#39;</span><span class="p">,</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="n">echo</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="n">echo</span> <span class="s2">&quot;three&quot;</span><span class="p">})</span>
<span class="n">results</span><span class="o">.</span><span class="n">waitForResults</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        
<footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
        
          
          <a href="TUTORIAL/" class="md-footer__link md-footer__link--next" aria-label="Next: Tutorial" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Tutorial
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
            
            Powered by
            <a href="http://timothycrosley.github.io/portray">portray.</a>
            You too can
            <a href="http://timothycrosley.github.io/portray">
              portray</a>
            your Python project well using automatic documentation.
          </div>
        
      </div>
    </div>
  </footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>